- name: Ensure Apache is installed
  package:
    name: 'httpd'
    state: 'present'
  become: true
- name: Prepare the vhost configuration
  template:
    src: httpd_vhost.j2
    dest: /etc/httpd/conf.d/dci.conf
  become: true
- name: httpd should not listen on all the interfaces
  lineinfile:
    path: /etc/httpd/conf/httpd.conf
    regexp: "^Listen .*"
    state: absent
  become: True
- name: Ensure Apache is restarted
  systemd:
    name: 'httpd'
    state: 'restarted'
  become: true
- command: ps aux
  become: true
- debug:
    msg: "So far so good, let's drop {{ dci_mirror_location }}/dci_repo"
- name: Drop existing repo dir
  file:
    path: '{{ dci_mirror_location }}/dci_repo'
    state: absent
  become: true
- name: Generating RSA key for stack
  user:
    name: '{{ ansible_user_id }}'
    generate_ssh_key: 'yes'
