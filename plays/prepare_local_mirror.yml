- name: Ensure python-firewall is installed
  package:
    name: 'python-firewall'
    state: 'present'
  become: true
# This to revert the previous behavior of the agent.
- name: Ensure Apache is installed
  package:
    name: 'httpd'
    state: 'present'
  become: true
- name: Prepare the vhost configuration
  template:
    src: httpd_vhost.j2
    dest: /etc/httpd/conf.d/dci.conf
  become: true
- name: Bind httpd on the $dci_base_ip
  replace:
    regexp: "^Listen .*"
    replace: "^Listen {{ dci_base_ip }}:80"
- name: Ensure Apache is restarted
  systemd:
    name: 'httpd'
    state: 'restarted'
  become: true
- name: Drop existing repo dir
  file:
    path: '{{ dci_mirror_location }}/dci_repo'
    state: absent
  become: true
- name: Generating RSA key for stack
  user:
    name: '{{ ansible_user_id }}'
    generate_ssh_key: 'yes'
